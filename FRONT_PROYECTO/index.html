<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ESP32 Car – Dashboard (vanilla + MQTT)</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <h1>ESP32 Car – Dashboard</h1>

  <div class="grid">
    <div class="card span4">
      <div class="row" style="justify-content:space-between;">
        <div>Conexión: <span id="conn" class="badge gray">conectando…</span></div>
        <div class="mono" id="clientId"></div>
      </div>
      <div class="kv" style="margin-top:10px">
        <div>Broker</div><div class="mono">broker.hivemq.com:8000/mqtt (WS)</div>
        <div>Tópicos</div><div class="mono">sebas/esp32car/#</div>
        <div>Estado</div><div class="mono" id="statusText">—</div>
        <div>Últ. alerta</div><div class="mono" id="alertText">—</div>
      </div>
    </div>

    <div class="card span8">
      <div class="row">
        <button class="btn" id="btnForward">↑ Forward</button>
        <button class="btn" id="btnLeft">← Left</button>
        <button class="btn stop" id="btnStop">■ Stop</button>
        <button class="btn" id="btnRight">Right →</button>
        <button class="btn" id="btnBackward">Backward ↓</button>
        <span>Velocidad: <span id="speedLbl" class="value">60</span>%</span>
        <input type="range" id="speed" min="0" max="100" value="60" />
        <span>Duración: <input id="duration" type="number" value="1.2" step="0.1" min="0.1" style="width:70px" /> s</span>
        <span>Safe stop: <input id="safe" type="number" value="20" step="1" min="5" style="width:70px" /> cm</span>
        <button class="btn secondary" id="btnApplySafe">Aplicar</button>
      </div>
      <div id="lastCmdBox" class="row" style="margin-top:8px; justify-content:space-between;">
        <div>Último comando: <span id="lastCmd" class="mono">—</span></div>
        <div>Confirmación: <span id="lastAck" class="badge gray">pendiente</span></div>
      </div>
    </div>

    <div class="card span6">
      <div class="row" style="justify-content:space-between;">
        <div>Distancia</div>
        <div id="obstacleBadge" class="badge gray">—</div>
      </div>
      <div style="font-size:42px; margin:8px 0;"><span id="distance" class="value">—</span> cm</div>
      <div class="mono" id="distanceRaw">—</div>
    </div>

    <div class="card span6">
      <div class="row" style="justify-content:space-between;">
        <div>Aceleración (m/s²)</div>
        <div class="mono" id="imuRaw">—</div>
      </div>
      <canvas id="accChart" height="160"></canvas>
    </div>

    <div class="card span12">
      <div class="row"><div>Logs</div></div>
      <pre id="log" class="mono" style="white-space:pre-wrap;max-height:220px;overflow:auto;margin:8px 0 0"></pre>
    </div>
  </div>

  <div id="toast"></div>

  <!-- Librerías desde CDN -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Tu lógica -->
  <script src="app.js"></script>
</body>
</html>
